{
  "project": "ralph-demo",
  "description": "Single-project Ralph demo: migrate LegacyTargetCode enum to string-based TargetKey data class in src/main/java/com/demo/obfuscated, driven by ralph_demo artifacts",
  "stories": [
    {
      "id": "US-001",
      "title": "Create TargetKey data class",
      "priority": 1,
      "passes": false,
      "acceptance_criteria": [
        "Create TargetKey class in com.demo.obfuscated with fields: value, account, project, environmentId, tenant",
        "Include equals/hashCode based on all fields",
        "Include getValueWithProject() that returns project__value or just value",
        "Include toString()",
        "Add unit tests for TargetKey"
      ]
    },
    {
      "id": "US-002",
      "title": "Create TargetRepository interface and in-memory implementation",
      "priority": 1,
      "passes": false,
      "acceptance_criteria": [
        "Create TargetRepository interface with findByValue, findByAccountProjectAndValue, findByTenantAndTarget, findAll",
        "Create InMemoryTargetRepository that seeds from LegacyTargetCode.values()",
        "Add unit tests for InMemoryTargetRepository"
      ]
    },
    {
      "id": "US-003",
      "title": "Add conversion methods to LegacyTargetCode",
      "priority": 2,
      "passes": false,
      "acceptance_criteria": [
        "Add LegacyTargetCode conversion methods: toTargetKey(), fromTargetKey(TargetKey), fromValue(String), fromTenantAndValue(String, String), fromAccountProjectAndValue(String, String, String)",
        "Ensure conversion behavior is defined and consistent for unknown or unmapped inputs (documented exception behavior)",
        "Create TargetConverter utility class with static fromLegacy/toLegacy methods that delegate to the canonical conversion behavior",
        "Add unit tests verifying round-trip conversion for all enum values",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-004",
      "title": "Add string-based target getter to RuleStrategy interface",
      "priority": 2,
      "passes": false,
      "acceptance_criteria": [
        "Add default method getTargetKey() to RuleStrategy that converts via TargetConverter",
        "Add default method getTargetValue() that returns the string value",
        "Update BaseRuleStrategy to support construction from TargetKey as well as enum",
        "Update ThresholdRuleStrategy, ExpressionRuleStrategy, RolloutRuleStrategy with TargetKey constructors",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-005",
      "title": "Update RuleBuilder with TargetKey support",
      "priority": 2,
      "passes": false,
      "acceptance_criteria": [
        "Add default method withTargetKey(TargetKey) to RuleBuilder interface",
        "Update RuleBuilderImpl to support building from TargetKey",
        "Add unit tests for building with TargetKey",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-006",
      "title": "Update serializer and deserializer for backward compatibility",
      "priority": 3,
      "passes": false,
      "acceptance_criteria": [
        "Update RuleStrategySerializer to write TargetKey fields (value, tenant, account, project, environmentId)",
        "Update RuleStrategyDeserializer to read both legacy enum name and new TargetKey fields",
        "Ensure backward compatibility: can deserialize old format and new format",
        "Add unit tests for both formats",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-007",
      "title": "Migrate RuleValidationService and WebhookHandler to use string-based targets",
      "priority": 3,
      "passes": false,
      "acceptance_criteria": [
        "Migrate RuleValidationService and WebhookHandler logic to target value-based behavior without relying on enum identity checks",
        "Preserve current behavior for all existing target cases while supporting TargetKey-based inputs",
        "Add TargetKey-accepting overloads where appropriate",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-008",
      "title": "Migrate FeatureToggleAdapter and TenantConfigLoader",
      "priority": 3,
      "passes": false,
      "acceptance_criteria": [
        "Update FeatureToggleAdapter to accept TargetKey in isEnabled and register methods",
        "Update TenantConfigLoader to return TargetKey from resolve methods",
        "Update TargetHandler to work with TargetKey",
        "Add TargetKey-based unit tests",
        "Existing tests must still pass"
      ]
    },
    {
      "id": "US-009",
      "title": "Deprecate LegacyTargetCode enum",
      "priority": 4,
      "passes": false,
      "acceptance_criteria": [
        "Add @Deprecated annotation to LegacyTargetCode enum",
        "Add deprecation Javadoc with migration instructions pointing to TargetKey",
        "Deprecate all methods that accept or return LegacyTargetCode with @Deprecated",
        "All tests pass with no compilation warnings in new code"
      ]
    }
  ]
}
